# Database Update Required - New Tables and Columns

## üîç Analysis Summary

After comparing `POSTGRESQL_ALL_TABLES_QUERIES.sql` with the existing database structure, here are **ALL the changes** you need to apply to your database:

---

## ‚úÖ NEW ENUM TYPE REQUIRED

### 1. `gallery_privacy_enum`
**Location:** Must be created before creating `photo_booth_galleries` table

```sql
CREATE TYPE gallery_privacy_enum AS ENUM ('public', 'password', 'private');
```

---

## üÜï NEW TABLES TO CREATE (8 Tables)

### 1. `photo_booth_galleries` (Table #19)
**Purpose:** Photo booth galleries with QR codes for event photos

```sql
CREATE TABLE IF NOT EXISTS photo_booth_galleries (
    gallery_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    photographer_id INT NOT NULL,
    booking_id INT,
    event_name VARCHAR(255) NOT NULL,
    qr_code VARCHAR(100) NOT NULL UNIQUE,
    qr_code_url TEXT,
    gallery_url VARCHAR(500) NOT NULL,
    privacy gallery_privacy_enum DEFAULT 'public',
    password_hash VARCHAR(255),
    expiry_date DATE,
    download_enabled BOOLEAN DEFAULT TRUE,
    watermark_enabled BOOLEAN DEFAULT FALSE,
    cover_photo_url VARCHAR(500),
    description TEXT,
    photo_count INT DEFAULT 0,
    access_count INT DEFAULT 0,
    download_count INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_galleries_photographer 
        FOREIGN KEY (photographer_id) 
        REFERENCES photographers(photographer_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_photo_booth_galleries_booking 
        FOREIGN KEY (booking_id) 
        REFERENCES bookings(booking_id) 
        ON DELETE SET NULL
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_photographer_id ON photo_booth_galleries(photographer_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_booking_id ON photo_booth_galleries(booking_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_qr_code ON photo_booth_galleries(qr_code);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_is_active ON photo_booth_galleries(is_active);
```

---

### 2. `photo_booth_gallery_photos` (Table #20)
**Purpose:** Individual photos in photo booth galleries

```sql
CREATE TABLE IF NOT EXISTS photo_booth_gallery_photos (
    photo_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    gallery_id INT NOT NULL,
    photo_url VARCHAR(500) NOT NULL,
    thumbnail_url VARCHAR(500),
    display_order INT DEFAULT 0,
    download_count INT DEFAULT 0,
    views_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_gallery_photos_gallery 
        FOREIGN KEY (gallery_id) 
        REFERENCES photo_booth_galleries(gallery_id) 
        ON DELETE CASCADE
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_photo_booth_gallery_photos_gallery_id ON photo_booth_gallery_photos(gallery_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_gallery_photos_display_order ON photo_booth_gallery_photos(display_order);
```

---

### 3. `photo_booth_access_logs` (Table #21)
**Purpose:** Track access to photo booth galleries (analytics)

```sql
CREATE TABLE IF NOT EXISTS photo_booth_access_logs (
    log_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    gallery_id INT NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_access_logs_gallery 
        FOREIGN KEY (gallery_id) 
        REFERENCES photo_booth_galleries(gallery_id) 
        ON DELETE CASCADE
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_photo_booth_access_logs_gallery_id ON photo_booth_access_logs(gallery_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_access_logs_accessed_at ON photo_booth_access_logs(accessed_at);
```

---

### 4. `collection_likes` (Table #22)
**Purpose:** Track likes on collections/moodboards

```sql
CREATE TABLE IF NOT EXISTS collection_likes (
    like_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_collection_likes_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_likes_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT uq_collection_like UNIQUE (collection_id, user_id)
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_collection_likes_collection_id ON collection_likes(collection_id);
CREATE INDEX IF NOT EXISTS idx_collection_likes_user_id ON collection_likes(user_id);
```

---

### 5. `collection_comments` (Table #23)
**Purpose:** Comments on collections/moodboards

```sql
CREATE TABLE IF NOT EXISTS collection_comments (
    comment_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    parent_comment_id INT,
    comment_text TEXT NOT NULL,
    likes_count INT DEFAULT 0,
    is_edited BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_collection_comments_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_comments_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_comments_parent 
        FOREIGN KEY (parent_comment_id) 
        REFERENCES collection_comments(comment_id) 
        ON DELETE CASCADE
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_collection_comments_collection_id ON collection_comments(collection_id);
CREATE INDEX IF NOT EXISTS idx_collection_comments_user_id ON collection_comments(user_id);
CREATE INDEX IF NOT EXISTS idx_collection_comments_parent_comment_id ON collection_comments(parent_comment_id);
```

---

### 6. `board_collaborators` (Table #24)
**Purpose:** Collaborative moodboards - users who can edit/view collections

```sql
CREATE TABLE IF NOT EXISTS board_collaborators (
    collaborator_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    permission_level VARCHAR(20) NOT NULL DEFAULT 'view',
    status VARCHAR(20) DEFAULT 'active',
    invited_by INT,
    invited_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_board_collaborators_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_board_collaborators_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_board_collaborators_invited_by 
        FOREIGN KEY (invited_by) 
        REFERENCES users(user_id) 
        ON DELETE SET NULL,
    CONSTRAINT uq_board_collaborator UNIQUE (collection_id, user_id)
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_board_collaborators_collection_id ON board_collaborators(collection_id);
CREATE INDEX IF NOT EXISTS idx_board_collaborators_user_id ON board_collaborators(user_id);
CREATE INDEX IF NOT EXISTS idx_board_collaborators_status ON board_collaborators(status);
```

---

### 7. `job_posts` (Table #25)
**Purpose:** Job postings by photographers looking for collaborators/assistants

```sql
CREATE TABLE IF NOT EXISTS job_posts (
    job_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    photographer_id INT NOT NULL,
    posted_by_user_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    job_title VARCHAR(255) NOT NULL,
    job_description TEXT,
    category VARCHAR(100),
    budget_min DECIMAL(10, 2),
    budget_max DECIMAL(10, 2),
    duration VARCHAR(50),
    urgency VARCHAR(20) DEFAULT 'normal',
    location VARCHAR(255),
    required_skills JSONB,
    application_deadline DATE,
    max_collaborators INT,
    is_remote BOOLEAN DEFAULT FALSE,
    status VARCHAR(20) DEFAULT 'open',
    view_count INT DEFAULT 0,
    applications_count INT DEFAULT 0,
    archived_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_job_posts_photographer 
        FOREIGN KEY (photographer_id) 
        REFERENCES photographers(photographer_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_job_posts_user 
        FOREIGN KEY (posted_by_user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_job_posts_photographer_id ON job_posts(photographer_id);
CREATE INDEX IF NOT EXISTS idx_job_posts_posted_by_user_id ON job_posts(posted_by_user_id);
CREATE INDEX IF NOT EXISTS idx_job_posts_status ON job_posts(status);
CREATE INDEX IF NOT EXISTS idx_job_posts_category ON job_posts(category);
CREATE INDEX IF NOT EXISTS idx_job_posts_location ON job_posts(location);
```

---

### 8. `job_applications` (Table #26)
**Purpose:** Applications submitted for job posts

```sql
CREATE TABLE IF NOT EXISTS job_applications (
    application_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    job_id INT NOT NULL,
    applicant_id INT NOT NULL,
    applicant_name VARCHAR(255) NOT NULL,
    applicant_email VARCHAR(255) NOT NULL,
    applicant_phone VARCHAR(20),
    cover_letter TEXT,
    portfolio_url VARCHAR(500),
    experience_years INT,
    expected_rate DECIMAL(10, 2),
    availability_start DATE,
    availability_end DATE,
    additional_info TEXT,
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_job_applications_job 
        FOREIGN KEY (job_id) 
        REFERENCES job_posts(job_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_job_applications_applicant 
        FOREIGN KEY (applicant_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT uq_job_application UNIQUE (job_id, applicant_id)
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_job_applications_job_id ON job_applications(job_id);
CREATE INDEX IF NOT EXISTS idx_job_applications_applicant_id ON job_applications(applicant_id);
CREATE INDEX IF NOT EXISTS idx_job_applications_status ON job_applications(status);
```

---

## üìù MODIFIED EXISTING TABLE

### `collections` Table - NEW COLUMN REQUIRED

**Add this column:**
```sql
ALTER TABLE collections 
ADD COLUMN IF NOT EXISTS comments_count INT DEFAULT 0;
```

**Note:** The `collections` table already had most columns, but `comments_count` is new and supports the new `collection_comments` table functionality.

---

## ‚ö†Ô∏è IMPORTANT NOTES

### 1. Messages Table - Group Support
The `messages` table in your SQL file shows `receiver_id INT NOT NULL`, but based on the Community Buzz migration, it should support `group_id` for group messages. However, since the CREATE TABLE statement doesn't include `group_id`, this suggests:

**If you already have the Community Buzz migration applied:**
- `messages` table should already have `group_id` column (added via migration)
- `receiver_id` should be nullable (modified via migration)

**If you haven't applied Community Buzz migration yet:**
- You'll need to add `group_id` column later when applying that migration

---

## üöÄ COMPLETE MIGRATION SCRIPT

Here's a complete migration script you can run to add all new tables:

```sql
-- ============================================================================
-- DATABASE UPDATE MIGRATION
-- Adds new tables: Photo Booth, Collection Features, Job Posts
-- Version: 2.0.0
-- ============================================================================

-- Step 1: Create new enum type
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'gallery_privacy_enum') THEN
        CREATE TYPE gallery_privacy_enum AS ENUM ('public', 'password', 'private');
    END IF;
END
$$;

-- Step 2: Add comments_count to collections table
ALTER TABLE collections 
ADD COLUMN IF NOT EXISTS comments_count INT DEFAULT 0;

-- Step 3: Create photo_booth_galleries table
CREATE TABLE IF NOT EXISTS photo_booth_galleries (
    gallery_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    photographer_id INT NOT NULL,
    booking_id INT,
    event_name VARCHAR(255) NOT NULL,
    qr_code VARCHAR(100) NOT NULL UNIQUE,
    qr_code_url TEXT,
    gallery_url VARCHAR(500) NOT NULL,
    privacy gallery_privacy_enum DEFAULT 'public',
    password_hash VARCHAR(255),
    expiry_date DATE,
    download_enabled BOOLEAN DEFAULT TRUE,
    watermark_enabled BOOLEAN DEFAULT FALSE,
    cover_photo_url VARCHAR(500),
    description TEXT,
    photo_count INT DEFAULT 0,
    access_count INT DEFAULT 0,
    download_count INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_galleries_photographer 
        FOREIGN KEY (photographer_id) 
        REFERENCES photographers(photographer_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_photo_booth_galleries_booking 
        FOREIGN KEY (booking_id) 
        REFERENCES bookings(booking_id) 
        ON DELETE SET NULL
);

CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_photographer_id ON photo_booth_galleries(photographer_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_booking_id ON photo_booth_galleries(booking_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_qr_code ON photo_booth_galleries(qr_code);
CREATE INDEX IF NOT EXISTS idx_photo_booth_galleries_is_active ON photo_booth_galleries(is_active);

-- Step 4: Create photo_booth_gallery_photos table
CREATE TABLE IF NOT EXISTS photo_booth_gallery_photos (
    photo_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    gallery_id INT NOT NULL,
    photo_url VARCHAR(500) NOT NULL,
    thumbnail_url VARCHAR(500),
    display_order INT DEFAULT 0,
    download_count INT DEFAULT 0,
    views_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_gallery_photos_gallery 
        FOREIGN KEY (gallery_id) 
        REFERENCES photo_booth_galleries(gallery_id) 
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_photo_booth_gallery_photos_gallery_id ON photo_booth_gallery_photos(gallery_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_gallery_photos_display_order ON photo_booth_gallery_photos(display_order);

-- Step 5: Create photo_booth_access_logs table
CREATE TABLE IF NOT EXISTS photo_booth_access_logs (
    log_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    gallery_id INT NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_photo_booth_access_logs_gallery 
        FOREIGN KEY (gallery_id) 
        REFERENCES photo_booth_galleries(gallery_id) 
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_photo_booth_access_logs_gallery_id ON photo_booth_access_logs(gallery_id);
CREATE INDEX IF NOT EXISTS idx_photo_booth_access_logs_accessed_at ON photo_booth_access_logs(accessed_at);

-- Step 6: Create collection_likes table
CREATE TABLE IF NOT EXISTS collection_likes (
    like_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_collection_likes_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_likes_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT uq_collection_like UNIQUE (collection_id, user_id)
);

CREATE INDEX IF NOT EXISTS idx_collection_likes_collection_id ON collection_likes(collection_id);
CREATE INDEX IF NOT EXISTS idx_collection_likes_user_id ON collection_likes(user_id);

-- Step 7: Create collection_comments table
CREATE TABLE IF NOT EXISTS collection_comments (
    comment_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    parent_comment_id INT,
    comment_text TEXT NOT NULL,
    likes_count INT DEFAULT 0,
    is_edited BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_collection_comments_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_comments_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_collection_comments_parent 
        FOREIGN KEY (parent_comment_id) 
        REFERENCES collection_comments(comment_id) 
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_collection_comments_collection_id ON collection_comments(collection_id);
CREATE INDEX IF NOT EXISTS idx_collection_comments_user_id ON collection_comments(user_id);
CREATE INDEX IF NOT EXISTS idx_collection_comments_parent_comment_id ON collection_comments(parent_comment_id);

-- Step 8: Create board_collaborators table
CREATE TABLE IF NOT EXISTS board_collaborators (
    collaborator_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    collection_id INT NOT NULL,
    user_id INT NOT NULL,
    permission_level VARCHAR(20) NOT NULL DEFAULT 'view',
    status VARCHAR(20) DEFAULT 'active',
    invited_by INT,
    invited_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_board_collaborators_collection 
        FOREIGN KEY (collection_id) 
        REFERENCES collections(collection_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_board_collaborators_user 
        FOREIGN KEY (user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_board_collaborators_invited_by 
        FOREIGN KEY (invited_by) 
        REFERENCES users(user_id) 
        ON DELETE SET NULL,
    CONSTRAINT uq_board_collaborator UNIQUE (collection_id, user_id)
);

CREATE INDEX IF NOT EXISTS idx_board_collaborators_collection_id ON board_collaborators(collection_id);
CREATE INDEX IF NOT EXISTS idx_board_collaborators_user_id ON board_collaborators(user_id);
CREATE INDEX IF NOT EXISTS idx_board_collaborators_status ON board_collaborators(status);

-- Step 9: Create job_posts table
CREATE TABLE IF NOT EXISTS job_posts (
    job_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    photographer_id INT NOT NULL,
    posted_by_user_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    job_title VARCHAR(255) NOT NULL,
    job_description TEXT,
    category VARCHAR(100),
    budget_min DECIMAL(10, 2),
    budget_max DECIMAL(10, 2),
    duration VARCHAR(50),
    urgency VARCHAR(20) DEFAULT 'normal',
    location VARCHAR(255),
    required_skills JSONB,
    application_deadline DATE,
    max_collaborators INT,
    is_remote BOOLEAN DEFAULT FALSE,
    status VARCHAR(20) DEFAULT 'open',
    view_count INT DEFAULT 0,
    applications_count INT DEFAULT 0,
    archived_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_job_posts_photographer 
        FOREIGN KEY (photographer_id) 
        REFERENCES photographers(photographer_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_job_posts_user 
        FOREIGN KEY (posted_by_user_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_job_posts_photographer_id ON job_posts(photographer_id);
CREATE INDEX IF NOT EXISTS idx_job_posts_posted_by_user_id ON job_posts(posted_by_user_id);
CREATE INDEX IF NOT EXISTS idx_job_posts_status ON job_posts(status);
CREATE INDEX IF NOT EXISTS idx_job_posts_category ON job_posts(category);
CREATE INDEX IF NOT EXISTS idx_job_posts_location ON job_posts(location);

-- Step 10: Create job_applications table
CREATE TABLE IF NOT EXISTS job_applications (
    application_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    job_id INT NOT NULL,
    applicant_id INT NOT NULL,
    applicant_name VARCHAR(255) NOT NULL,
    applicant_email VARCHAR(255) NOT NULL,
    applicant_phone VARCHAR(20),
    cover_letter TEXT,
    portfolio_url VARCHAR(500),
    experience_years INT,
    expected_rate DECIMAL(10, 2),
    availability_start DATE,
    availability_end DATE,
    additional_info TEXT,
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_job_applications_job 
        FOREIGN KEY (job_id) 
        REFERENCES job_posts(job_id) 
        ON DELETE CASCADE,
    CONSTRAINT fk_job_applications_applicant 
        FOREIGN KEY (applicant_id) 
        REFERENCES users(user_id) 
        ON DELETE CASCADE,
    CONSTRAINT uq_job_application UNIQUE (job_id, applicant_id)
);

CREATE INDEX IF NOT EXISTS idx_job_applications_job_id ON job_applications(job_id);
CREATE INDEX IF NOT EXISTS idx_job_applications_applicant_id ON job_applications(applicant_id);
CREATE INDEX IF NOT EXISTS idx_job_applications_status ON job_applications(status);

-- Add triggers for updated_at (if needed)
DROP TRIGGER IF EXISTS photo_booth_galleries_set_timestamp ON photo_booth_galleries;
CREATE TRIGGER photo_booth_galleries_set_timestamp
BEFORE UPDATE ON photo_booth_galleries
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS collection_comments_set_timestamp ON collection_comments;
CREATE TRIGGER collection_comments_set_timestamp
BEFORE UPDATE ON collection_comments
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS board_collaborators_set_timestamp ON board_collaborators;
CREATE TRIGGER board_collaborators_set_timestamp
BEFORE UPDATE ON board_collaborators
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS job_posts_set_timestamp ON job_posts;
CREATE TRIGGER job_posts_set_timestamp
BEFORE UPDATE ON job_posts
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS job_applications_set_timestamp ON job_applications;
CREATE TRIGGER job_applications_set_timestamp
BEFORE UPDATE ON job_applications
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();

-- Verification
DO $$
BEGIN
    RAISE NOTICE '‚úÖ Database update migration completed successfully!';
    RAISE NOTICE '‚úÖ Added 1 new enum type: gallery_privacy_enum';
    RAISE NOTICE '‚úÖ Added 8 new tables: photo_booth_galleries, photo_booth_gallery_photos, photo_booth_access_logs, collection_likes, collection_comments, board_collaborators, job_posts, job_applications';
    RAISE NOTICE '‚úÖ Updated collections table: added comments_count column';
END
$$;
```

---

## üìä SUMMARY OF CHANGES

| Change Type | Count | Details |
|-------------|-------|---------|
| **New Enum Types** | 1 | `gallery_privacy_enum` |
| **New Tables** | 8 | Photo Booth (3), Collections (3), Jobs (2) |
| **Modified Tables** | 1 | `collections` - added `comments_count` |
| **Total Changes** | 10 | |

---

## üéØ NEW FEATURES ADDED

### 1. **Photo Booth Feature** (3 tables)
- QR code-based photo galleries
- Access tracking and analytics
- Privacy controls (public/password/private)

### 2. **Enhanced Collections** (3 tables)
- Likes on collections
- Comments on collections
- Collaborative moodboards (invite users)

### 3. **Job Postings** (2 tables)
- Photographers can post job openings
- Users can apply for jobs
- Application tracking and management

---

## ‚úÖ VERIFICATION CHECKLIST

After running the migration, verify:

- [ ] `gallery_privacy_enum` type exists
- [ ] `collections.comments_count` column exists
- [ ] `photo_booth_galleries` table exists
- [ ] `photo_booth_gallery_photos` table exists
- [ ] `photo_booth_access_logs` table exists
- [ ] `collection_likes` table exists
- [ ] `collection_comments` table exists
- [ ] `board_collaborators` table exists
- [ ] `job_posts` table exists
- [ ] `job_applications` table exists
- [ ] All foreign key constraints are working
- [ ] All indexes are created
- [ ] Triggers are set up correctly

**Verification Query:**
```sql
SELECT 
    table_name,
    (SELECT COUNT(*) FROM information_schema.columns 
     WHERE table_name = t.table_name) as column_count
FROM information_schema.tables t
WHERE table_schema = 'public' 
  AND table_name IN (
    'photo_booth_galleries',
    'photo_booth_gallery_photos',
    'photo_booth_access_logs',
    'collection_likes',
    'collection_comments',
    'board_collaborators',
    'job_posts',
    'job_applications'
  )
ORDER BY table_name;
```

---

**Last Updated:** 2025-01-XX  
**Migration Version:** 2.0.0











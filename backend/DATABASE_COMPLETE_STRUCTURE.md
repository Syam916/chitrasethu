# Chitrasethu Database - Complete Structure Documentation

## üìä Database Overview

**Database Name:** `chitrasethu`  
**Database Type:** PostgreSQL 12+  
**Character Set:** UTF-8  
**Version:** 1.0.0

---

## üìã Table Structure - All Tables and Columns

### 1. USER MANAGEMENT TABLES

#### Table: `users`
**Purpose:** Core user authentication and basic information

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| user_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| email | VARCHAR(255) | NOT NULL, UNIQUE | User email for login |
| password_hash | VARCHAR(255) | NOT NULL | Bcrypt hashed password |
| user_type | user_type_enum | NOT NULL, DEFAULT 'customer' | Enum: 'customer', 'photographer', 'admin' |
| is_verified | BOOLEAN | DEFAULT FALSE | Email verification status |
| is_active | BOOLEAN | DEFAULT TRUE | Account active status |
| verification_token | VARCHAR(255) | | Email verification token |
| reset_password_token | VARCHAR(255) | | Password reset token |
| reset_password_expires | TIMESTAMP | | Password reset expiry |
| last_login | TIMESTAMP | | Last login timestamp |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_users_email` ON (email)
- `idx_users_user_type` ON (user_type)
- `idx_users_is_active` ON (is_active)

---

#### Table: `user_profiles`
**Purpose:** Extended user profile information

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| profile_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, UNIQUE, FK ‚Üí users(user_id) | Links to users table |
| full_name | VARCHAR(255) | NOT NULL | Display name |
| avatar_url | VARCHAR(500) | | Profile picture URL |
| avatar_public_id | VARCHAR(255) | | Cloudinary public_id for avatar |
| bio | TEXT | | User biography |
| phone | VARCHAR(20) | | Contact number |
| location | VARCHAR(255) | | Full address |
| city | VARCHAR(100) | | City name |
| state | VARCHAR(100) | | State name |
| country | VARCHAR(100) | DEFAULT 'India' | Country name |
| pincode | VARCHAR(10) | | Postal code |
| date_of_birth | DATE | | Date of birth |
| gender | gender_enum | | Enum: 'male', 'female', 'other', 'prefer_not_to_say' |
| social_links | JSONB | | Social media links |
| preferences | JSONB | | User preferences |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_user_profiles_location` ON (city, state)
- `idx_user_profiles_full_name` ON (full_name)

---

#### Table: `user_roles`
**Purpose:** Define user roles and permissions

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| role_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| role_name | VARCHAR(50) | NOT NULL, UNIQUE | Role name |
| display_name | VARCHAR(100) | NOT NULL | Display name |
| description | TEXT | | Role description |
| permissions | JSONB | | Permission flags |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_user_roles_name` ON (role_name)

---

#### Table: `user_sessions`
**Purpose:** Track active user sessions

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| session_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Links to users table |
| token | VARCHAR(500) | NOT NULL, UNIQUE | JWT token |
| device_info | VARCHAR(255) | | Browser/device details |
| ip_address | VARCHAR(45) | | Login IP address |
| user_agent | TEXT | | User agent string |
| expires_at | TIMESTAMP | NOT NULL | Session expiry |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_user_sessions_user_id` ON (user_id)
- `idx_user_sessions_token` ON (token)
- `idx_user_sessions_expires_at` ON (expires_at)

---

### 2. PHOTOGRAPHER MANAGEMENT TABLES

#### Table: `photographers`
**Purpose:** Professional photographer profiles and business information

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| photographer_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, UNIQUE, FK ‚Üí users(user_id) | Links to users table |
| business_name | VARCHAR(255) | | Studio/business name |
| specialties | JSONB | NOT NULL | Array of specialties |
| experience_years | INT | DEFAULT 0 | Years of experience |
| base_price | DECIMAL(10, 2) | | Starting price |
| currency | VARCHAR(10) | DEFAULT 'INR' | Currency code |
| rating | DECIMAL(3, 2) | DEFAULT 0.00 | Average rating (0-5) |
| total_reviews | INT | DEFAULT 0 | Total review count |
| total_bookings | INT | DEFAULT 0 | Total booking count |
| equipment | JSONB | | Equipment list |
| languages | JSONB | | Languages spoken |
| services_offered | JSONB | | Services offered |
| certifications | TEXT | | Certifications |
| awards | TEXT | | Awards received |
| work_radius | INT | DEFAULT 50 | Work radius in km |
| is_verified | BOOLEAN | DEFAULT FALSE | Verification badge |
| is_premium | BOOLEAN | DEFAULT FALSE | Premium membership |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| verification_date | TIMESTAMP | | Verification date |
| premium_until | TIMESTAMP | | Premium expiry |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_photographers_rating` ON (rating)
- `idx_photographers_is_verified` ON (is_verified)
- `idx_photographers_is_premium` ON (is_premium)
- `idx_photographers_base_price` ON (base_price)

---

#### Table: `photographer_portfolios`
**Purpose:** Store photographer portfolio items

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| portfolio_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| photographer_id | INT | NOT NULL, FK ‚Üí photographers(photographer_id) | Links to photographers |
| image_url | VARCHAR(500) | NOT NULL | Portfolio image URL |
| thumbnail_url | VARCHAR(500) | | Thumbnail URL |
| title | VARCHAR(255) | | Image title |
| description | TEXT | | Image description |
| category | VARCHAR(100) | | Event category |
| tags | JSONB | | Tags array |
| display_order | INT | DEFAULT 0 | Sort order |
| likes_count | INT | DEFAULT 0 | Likes count |
| views_count | INT | DEFAULT 0 | Views count |
| is_featured | BOOLEAN | DEFAULT FALSE | Featured flag |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| post_id | INT | | Links to posts table (nullable) |
| public_id | VARCHAR(255) | | Cloudinary public_id |
| width | INT | | Image width |
| height | INT | | Image height |
| format | VARCHAR(10) | | Image format |
| bytes | BIGINT | | File size in bytes |
| cloudinary_folder | VARCHAR(255) | | Cloudinary folder path |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_portfolios_photographer_id` ON (photographer_id)
- `idx_portfolios_category` ON (category)
- `idx_portfolios_display_order` ON (display_order)
- `idx_portfolios_is_featured` ON (is_featured)
- `idx_portfolios_post_id` ON (post_id)
- `idx_portfolios_public_id` ON (public_id)

---

#### Table: `photographer_availability`
**Purpose:** Manage photographer calendar availability

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| availability_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| photographer_id | INT | NOT NULL, FK ‚Üí photographers(photographer_id) | Links to photographers |
| date | DATE | NOT NULL | Available date |
| time_slot | VARCHAR(50) | NOT NULL | Time slot identifier |
| start_time | TIME | NOT NULL | Start time |
| end_time | TIME | NOT NULL | End time |
| is_available | BOOLEAN | DEFAULT TRUE | Availability status |
| booking_id | INT | | Linked booking (nullable) |
| notes | TEXT | | Additional notes |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Constraints:**
- UNIQUE (photographer_id, date, time_slot)

**Indexes:**
- `idx_availability_photographer_date` ON (photographer_id, date)
- `idx_availability_date` ON (date)
- `idx_availability_is_available` ON (is_available)

---

### 3. EVENT & BOOKING MANAGEMENT TABLES

#### Table: `event_categories`
**Purpose:** Define event types and categories

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| category_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| category_name | VARCHAR(100) | NOT NULL, UNIQUE | Category name |
| slug | VARCHAR(100) | NOT NULL, UNIQUE | URL-friendly slug |
| description | TEXT | | Category description |
| icon | VARCHAR(100) | | Icon identifier |
| color_code | VARCHAR(20) | | UI color code |
| display_order | INT | DEFAULT 0 | Display order |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_event_categories_slug` ON (slug)
- `idx_event_categories_display_order` ON (display_order)

---

#### Table: `events`
**Purpose:** Store event listings and details

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| event_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| creator_id | INT | NOT NULL, FK ‚Üí users(user_id) | Event creator |
| category_id | INT | NOT NULL, FK ‚Üí event_categories(category_id) | Event category |
| title | VARCHAR(255) | NOT NULL | Event title |
| description | TEXT | | Event description |
| event_date | DATE | NOT NULL | Event date |
| event_time | TIME | | Event time |
| end_date | DATE | | End date |
| location | VARCHAR(255) | | Venue location |
| venue_name | VARCHAR(255) | | Venue name |
| city | VARCHAR(100) | | City name |
| state | VARCHAR(100) | | State name |
| expected_attendees | INT | | Expected guest count |
| budget_range | VARCHAR(100) | | Budget range text |
| min_budget | DECIMAL(10, 2) | | Minimum budget |
| max_budget | DECIMAL(10, 2) | | Maximum budget |
| requirements | TEXT | | Special requirements |
| status | event_status_enum | DEFAULT 'open' | Enum: 'open', 'in_progress', 'completed', 'cancelled' |
| visibility | event_visibility_enum | DEFAULT 'public' | Enum: 'public', 'private' |
| images | JSONB | | Event images array |
| tags | JSONB | | Tags array |
| views_count | INT | DEFAULT 0 | Views count |
| interested_count | INT | DEFAULT 0 | Interested count |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_events_creator_id` ON (creator_id)
- `idx_events_category_id` ON (category_id)
- `idx_events_event_date` ON (event_date)
- `idx_events_status` ON (status)
- `idx_events_city` ON (city)

---

#### Table: `bookings`
**Purpose:** Manage booking requests and confirmations

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| booking_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| customer_id | INT | NOT NULL, FK ‚Üí users(user_id) | Customer making booking |
| photographer_id | INT | NOT NULL, FK ‚Üí photographers(photographer_id) | Booked photographer |
| event_id | INT | FK ‚Üí events(event_id), ON DELETE SET NULL | Related event (nullable) |
| booking_date | DATE | NOT NULL | Service date |
| booking_time | TIME | | Service time |
| end_date | DATE | | Service end date |
| duration_hours | DECIMAL(5, 2) | | Service duration |
| location | VARCHAR(255) | | Service location |
| venue_name | VARCHAR(255) | | Venue name |
| event_type | VARCHAR(100) | | Event type |
| total_amount | DECIMAL(10, 2) | NOT NULL | Total price |
| advance_amount | DECIMAL(10, 2) | | Advance payment |
| pending_amount | DECIMAL(10, 2) | | Pending payment |
| currency | VARCHAR(10) | DEFAULT 'INR' | Currency code |
| status | booking_status_enum | DEFAULT 'pending' | Enum: 'pending', 'confirmed', 'in_progress', 'completed', 'cancelled', 'refunded' |
| payment_status | booking_payment_status_enum | DEFAULT 'unpaid' | Enum: 'unpaid', 'partial', 'paid', 'refunded' |
| special_requirements | TEXT | | Special requirements |
| cancellation_reason | TEXT | | Cancellation reason |
| cancelled_by | INT | | User who cancelled |
| cancelled_at | TIMESTAMP | | Cancellation timestamp |
| confirmed_at | TIMESTAMP | | Confirmation timestamp |
| completed_at | TIMESTAMP | | Completion timestamp |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_bookings_customer_id` ON (customer_id)
- `idx_bookings_photographer_id` ON (photographer_id)
- `idx_bookings_booking_date` ON (booking_date)
- `idx_bookings_status` ON (status)
- `idx_bookings_payment_status` ON (payment_status)

---

#### Table: `booking_payments`
**Purpose:** Track payment transactions

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| payment_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| booking_id | INT | NOT NULL, FK ‚Üí bookings(booking_id) | Links to booking |
| amount | DECIMAL(10, 2) | NOT NULL | Payment amount |
| currency | VARCHAR(10) | DEFAULT 'INR' | Currency code |
| payment_type | payment_type_enum | NOT NULL | Enum: 'advance', 'partial', 'full', 'refund' |
| payment_method | VARCHAR(50) | | Payment method |
| payment_status | payment_status_enum | DEFAULT 'pending' | Enum: 'pending', 'processing', 'completed', 'failed', 'refunded' |
| transaction_id | VARCHAR(255) | UNIQUE | Gateway transaction ID |
| payment_gateway | VARCHAR(50) | | Payment gateway name |
| gateway_response | JSONB | | Gateway response data |
| payment_date | TIMESTAMP | | Payment timestamp |
| refund_amount | DECIMAL(10, 2) | | Refund amount |
| refund_date | TIMESTAMP | | Refund timestamp |
| refund_reason | TEXT | | Refund reason |
| notes | TEXT | | Additional notes |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_booking_payments_booking_id` ON (booking_id)
- `idx_booking_payments_transaction_id` ON (transaction_id)
- `idx_booking_payments_status` ON (payment_status)
- `idx_booking_payments_payment_date` ON (payment_date)

---

#### Table: `booking_reviews`
**Purpose:** Store booking reviews and ratings

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| review_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| booking_id | INT | NOT NULL, UNIQUE, FK ‚Üí bookings(booking_id) | Links to booking |
| photographer_id | INT | NOT NULL, FK ‚Üí photographers(photographer_id) | Reviewed photographer |
| customer_id | INT | NOT NULL, FK ‚Üí users(user_id) | Reviewer |
| rating | INT | NOT NULL, CHECK (1-5) | Rating (1-5 stars) |
| review_text | TEXT | | Review text |
| review_images | JSONB | | Review images array |
| response_text | TEXT | | Photographer response |
| response_date | TIMESTAMP | | Response timestamp |
| is_verified | BOOLEAN | DEFAULT FALSE | Verified review flag |
| is_featured | BOOLEAN | DEFAULT FALSE | Featured review flag |
| helpful_count | INT | DEFAULT 0 | Helpful count |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_booking_reviews_photographer_id` ON (photographer_id)
- `idx_booking_reviews_rating` ON (rating)
- `idx_booking_reviews_is_featured` ON (is_featured)

---

### 4. SOCIAL FEATURES TABLES

#### Table: `posts`
**Purpose:** Social media posts and content

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| post_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Post author |
| content_type | post_content_type_enum | NOT NULL, DEFAULT 'image' | Enum: 'image', 'video', 'text', 'gallery' |
| caption | TEXT | | Post caption |
| media_urls | JSONB | | Media URLs array with Cloudinary metadata |
| thumbnail_url | VARCHAR(500) | | Thumbnail URL |
| location | VARCHAR(255) | | Tagged location |
| tags | JSONB | | Tags/hashtags array |
| mentions | JSONB | | Mentions array |
| likes_count | INT | DEFAULT 0 | Likes count |
| comments_count | INT | DEFAULT 0 | Comments count |
| shares_count | INT | DEFAULT 0 | Shares count |
| views_count | INT | DEFAULT 0 | Views count |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| is_featured | BOOLEAN | DEFAULT FALSE | Featured flag |
| visibility | post_visibility_enum | DEFAULT 'public' | Enum: 'public', 'followers', 'private' |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_posts_user_id` ON (user_id)
- `idx_posts_created_at` ON (created_at)
- `idx_posts_is_featured` ON (is_featured)
- `idx_posts_caption_fulltext` USING GIN (to_tsvector('english', caption))

---

#### Table: `post_likes`
**Purpose:** Track post likes

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| like_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| post_id | INT | NOT NULL, FK ‚Üí posts(post_id) | Links to post |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | User who liked |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Like timestamp |

**Constraints:**
- UNIQUE (post_id, user_id)

**Indexes:**
- `idx_post_likes_post_id` ON (post_id)
- `idx_post_likes_user_id` ON (user_id)

---

#### Table: `post_comments`
**Purpose:** Store post comments

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| comment_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| post_id | INT | NOT NULL, FK ‚Üí posts(post_id) | Links to post |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Comment author |
| parent_comment_id | INT | FK ‚Üí post_comments(comment_id) | Parent comment for replies |
| comment_text | TEXT | NOT NULL | Comment text |
| likes_count | INT | DEFAULT 0 | Likes count |
| is_edited | BOOLEAN | DEFAULT FALSE | Edited flag |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_post_comments_post_id` ON (post_id)
- `idx_post_comments_user_id` ON (user_id)
- `idx_post_comments_parent_comment_id` ON (parent_comment_id)

---

#### Table: `collections`
**Purpose:** Curated photo collections and moodboards

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| collection_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Collection creator |
| title | VARCHAR(255) | NOT NULL | Collection title |
| description | TEXT | | Collection description |
| thumbnail_url | VARCHAR(500) | | Thumbnail URL |
| images | JSONB | | Images array |
| category | VARCHAR(100) | | Collection category |
| tags | JSONB | | Tags array |
| is_public | BOOLEAN | DEFAULT TRUE | Public/private flag |
| likes_count | INT | DEFAULT 0 | Likes count |
| saves_count | INT | DEFAULT 0 | Saves count |
| views_count | INT | DEFAULT 0 | Views count |
| is_featured | BOOLEAN | DEFAULT FALSE | Featured flag |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_collections_user_id` ON (user_id)
- `idx_collections_category` ON (category)
- `idx_collections_is_public` ON (is_public)
- `idx_collections_is_featured` ON (is_featured)

---

### 5. COMMUNICATION TABLES

#### Table: `messages`
**Purpose:** Direct messaging and group chat messages

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| message_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| sender_id | INT | NOT NULL, FK ‚Üí users(user_id) | Message sender |
| receiver_id | INT | FK ‚Üí users(user_id), NULL for group messages | Message receiver (nullable) |
| group_id | INT | FK ‚Üí community_groups(group_id), NULL for direct messages | Group ID for group chats (nullable) |
| message_text | TEXT | NOT NULL | Message content |
| message_type | message_type_enum | DEFAULT 'text' | Enum: 'text', 'image', 'file' |
| attachment_url | VARCHAR(500) | | Attachment URL |
| attachment_public_id | VARCHAR(255) | | Cloudinary public_id for attachment |
| is_read | BOOLEAN | DEFAULT FALSE | Read status |
| read_at | TIMESTAMP | | Read timestamp |
| is_deleted_by_sender | BOOLEAN | DEFAULT FALSE | Deleted by sender flag |
| is_deleted_by_receiver | BOOLEAN | DEFAULT FALSE | Deleted by receiver flag |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_messages_sender_id` ON (sender_id)
- `idx_messages_receiver_id` ON (receiver_id)
- `idx_messages_group_id` ON (group_id)
- `idx_messages_conversation` ON (sender_id, receiver_id, created_at)
- `idx_messages_is_read` ON (is_read)
- `idx_messages_group_created` ON (group_id, created_at DESC) WHERE group_id IS NOT NULL

**Note:** Either `receiver_id` or `group_id` must be set (application logic enforces this)

---

#### Table: `notifications`
**Purpose:** User notifications and alerts

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| notification_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Notification recipient |
| type | notification_type_enum | NOT NULL | Enum: 'booking', 'message', 'like', 'comment', 'review', 'payment', 'system' |
| title | VARCHAR(255) | NOT NULL | Notification title |
| message | TEXT | NOT NULL | Notification message |
| link | VARCHAR(500) | | Action URL |
| data | JSONB | | Additional data |
| is_read | BOOLEAN | DEFAULT FALSE | Read status |
| read_at | TIMESTAMP | | Read timestamp |
| priority | notification_priority_enum | DEFAULT 'medium' | Enum: 'low', 'medium', 'high' |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_notifications_user_id` ON (user_id)
- `idx_notifications_is_read` ON (is_read)
- `idx_notifications_type` ON (type)
- `idx_notifications_created_at` ON (created_at)

---

### 6. COMMUNITY BUZZ TABLES (Additional Features)

#### Table: `discussion_topics`
**Purpose:** Discussion topics/threads for Community Buzz

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| topic_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Topic creator |
| title | VARCHAR(255) | NOT NULL | Topic title |
| description | TEXT | | Topic description |
| category | VARCHAR(100) | NOT NULL | Category: Equipment, Business, Post-Processing, etc. |
| replies_count | INT | DEFAULT 0 | Replies count |
| views_count | INT | DEFAULT 0 | Views count |
| is_hot | BOOLEAN | DEFAULT FALSE | Hot topic flag |
| is_pinned | BOOLEAN | DEFAULT FALSE | Pinned flag |
| is_locked | BOOLEAN | DEFAULT FALSE | Locked flag |
| last_activity_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Last activity timestamp |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_discussion_topics_user_id` ON (user_id)
- `idx_discussion_topics_category` ON (category)
- `idx_discussion_topics_last_activity` ON (last_activity_at DESC)
- `idx_discussion_topics_is_hot` ON (is_hot)
- `idx_discussion_topics_is_pinned` ON (is_pinned)
- `idx_discussion_topics_created_at` ON (created_at DESC)
- `idx_discussion_topics_search` USING GIN (to_tsvector('english', COALESCE(title, '') || ' ' || COALESCE(description, '')))

---

#### Table: `discussion_replies`
**Purpose:** Replies to discussion topics

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| reply_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| topic_id | INT | NOT NULL, FK ‚Üí discussion_topics(topic_id) | Links to topic |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Reply author |
| reply_text | TEXT | NOT NULL | Reply text |
| parent_reply_id | INT | FK ‚Üí discussion_replies(reply_id) | Parent reply for nested replies |
| likes_count | INT | DEFAULT 0 | Likes count |
| is_edited | BOOLEAN | DEFAULT FALSE | Edited flag |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_discussion_replies_topic_id` ON (topic_id)
- `idx_discussion_replies_user_id` ON (user_id)
- `idx_discussion_replies_parent_reply_id` ON (parent_reply_id)
- `idx_discussion_replies_created_at` ON (created_at ASC)
- `idx_discussion_replies_is_active` ON (is_active)

---

#### Table: `community_groups`
**Purpose:** Community groups for photographers

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| group_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| creator_id | INT | NOT NULL, FK ‚Üí users(user_id) | Group creator |
| group_name | VARCHAR(255) | NOT NULL | Group name |
| group_type | group_type_enum | NOT NULL, DEFAULT 'other' | Enum: 'regional', 'project', 'network', 'equipment', 'other' |
| description | TEXT | | Group description |
| group_icon_url | VARCHAR(500) | | Group icon URL |
| member_count | INT | DEFAULT 0 | Member count |
| is_public | BOOLEAN | DEFAULT TRUE | Public/private flag |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| last_activity_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Last activity timestamp |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_community_groups_creator_id` ON (creator_id)
- `idx_community_groups_group_type` ON (group_type)
- `idx_community_groups_is_public` ON (is_public)
- `idx_community_groups_is_active` ON (is_active)
- `idx_community_groups_last_activity` ON (last_activity_at DESC)
- `idx_community_groups_created_at` ON (created_at DESC)

---

#### Table: `group_members`
**Purpose:** Membership tracking for community groups

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| member_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| group_id | INT | NOT NULL, FK ‚Üí community_groups(group_id) | Links to group |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Group member |
| role | group_role_enum | NOT NULL, DEFAULT 'member' | Enum: 'admin', 'moderator', 'member' |
| joined_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Join timestamp |
| unread_count | INT | DEFAULT 0 | Unread messages count |

**Constraints:**
- UNIQUE (group_id, user_id)

**Indexes:**
- `idx_group_members_group_id` ON (group_id)
- `idx_group_members_user_id` ON (user_id)
- `idx_group_members_role` ON (role)

---

#### Table: `collaborations`
**Purpose:** Collaboration opportunities (seeking/offering)

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| collaboration_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Collaboration creator |
| collaboration_type | collaboration_type_enum | NOT NULL | Enum: 'seeking', 'offering' |
| title | VARCHAR(255) | NOT NULL | Collaboration title |
| description | TEXT | NOT NULL | Collaboration description |
| skills | JSONB | | Required/offered skills array |
| location | VARCHAR(255) | | Location |
| date | VARCHAR(255) | | Date string (flexible format) |
| budget | VARCHAR(255) | | Budget range text |
| min_budget | DECIMAL(10, 2) | | Minimum budget |
| max_budget | DECIMAL(10, 2) | | Maximum budget |
| responses_count | INT | DEFAULT 0 | Responses count |
| is_active | BOOLEAN | DEFAULT TRUE | Active status |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Indexes:**
- `idx_collaborations_user_id` ON (user_id)
- `idx_collaborations_type` ON (collaboration_type)
- `idx_collaborations_location` ON (location)
- `idx_collaborations_is_active` ON (is_active)
- `idx_collaborations_created_at` ON (created_at DESC)
- `idx_collaborations_skills` USING GIN (skills)
- `idx_collaborations_search` USING GIN (to_tsvector('english', COALESCE(title, '') || ' ' || COALESCE(description, '')))

---

#### Table: `collaboration_responses`
**Purpose:** Responses to collaboration posts

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| response_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| collaboration_id | INT | NOT NULL, FK ‚Üí collaborations(collaboration_id) | Links to collaboration |
| user_id | INT | NOT NULL, FK ‚Üí users(user_id) | Responder |
| message | TEXT | | Response message |
| status | collaboration_response_status_enum | NOT NULL, DEFAULT 'pending' | Enum: 'pending', 'accepted', 'declined', 'withdrawn' |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Update timestamp |

**Constraints:**
- UNIQUE (collaboration_id, user_id)

**Indexes:**
- `idx_collaboration_responses_collaboration_id` ON (collaboration_id)
- `idx_collaboration_responses_user_id` ON (user_id)
- `idx_collaboration_responses_status` ON (status)
- `idx_collaboration_responses_created_at` ON (created_at DESC)

---

#### Table: `follows`
**Purpose:** User follow/following relationships

| Column Name | Data Type | Constraints | Description |
|-------------|-----------|-------------|-------------|
| follow_id | INT | PRIMARY KEY, GENERATED BY DEFAULT AS IDENTITY | Unique identifier |
| follower_id | INT | NOT NULL, FK ‚Üí users(user_id) | User who follows |
| following_id | INT | NOT NULL, FK ‚Üí users(user_id) | User being followed |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Follow timestamp |

**Constraints:**
- UNIQUE (follower_id, following_id)
- CHECK (follower_id != following_id) - Cannot follow self

**Indexes:**
- `idx_follows_follower_id` ON (follower_id)
- `idx_follows_following_id` ON (following_id)
- `idx_follows_created_at` ON (created_at DESC)

---

## üìä ENUM TYPES

### PostgreSQL Custom Enums

1. **user_type_enum**
   - 'customer'
   - 'photographer'
   - 'admin'

2. **gender_enum**
   - 'male'
   - 'female'
   - 'other'
   - 'prefer_not_to_say'

3. **event_status_enum**
   - 'open'
   - 'in_progress'
   - 'completed'
   - 'cancelled'

4. **event_visibility_enum**
   - 'public'
   - 'private'

5. **booking_status_enum**
   - 'pending'
   - 'confirmed'
   - 'in_progress'
   - 'completed'
   - 'cancelled'
   - 'refunded'

6. **booking_payment_status_enum**
   - 'unpaid'
   - 'partial'
   - 'paid'
   - 'refunded'

7. **payment_type_enum**
   - 'advance'
   - 'partial'
   - 'full'
   - 'refund'

8. **payment_status_enum**
   - 'pending'
   - 'processing'
   - 'completed'
   - 'failed'
   - 'refunded'

9. **post_content_type_enum**
   - 'image'
   - 'video'
   - 'text'
   - 'gallery'

10. **post_visibility_enum**
    - 'public'
    - 'followers'
    - 'private'

11. **message_type_enum**
    - 'text'
    - 'image'
    - 'file'

12. **notification_type_enum**
    - 'booking'
    - 'message'
    - 'like'
    - 'comment'
    - 'review'
    - 'payment'
    - 'system'

13. **notification_priority_enum**
    - 'low'
    - 'medium'
    - 'high'

14. **group_type_enum**
    - 'regional'
    - 'project'
    - 'network'
    - 'equipment'
    - 'other'

15. **group_role_enum**
    - 'admin'
    - 'moderator'
    - 'member'

16. **collaboration_type_enum**
    - 'seeking'
    - 'offering'

17. **collaboration_response_status_enum**
    - 'pending'
    - 'accepted'
    - 'declined'
    - 'withdrawn'

---

## üîó TABLE RELATIONSHIPS

### Foreign Key Relationships

1. **users** ‚Üê user_profiles (1:1)
2. **users** ‚Üê user_sessions (1:N)
3. **users** ‚Üê photographers (1:1)
4. **users** ‚Üê events (1:N, creator)
5. **users** ‚Üê bookings (1:N, customer)
6. **users** ‚Üê posts (1:N)
7. **users** ‚Üê messages (1:N, sender/receiver)
8. **users** ‚Üê notifications (1:N)
9. **users** ‚Üê discussion_topics (1:N)
10. **users** ‚Üê discussion_replies (1:N)
11. **users** ‚Üê community_groups (1:N, creator)
12. **users** ‚Üê collaborations (1:N)
13. **photographers** ‚Üê photographer_portfolios (1:N)
14. **photographers** ‚Üê photographer_availability (1:N)
15. **photographers** ‚Üê bookings (1:N)
16. **photographers** ‚Üê booking_reviews (1:N)
17. **event_categories** ‚Üê events (1:N)
18. **events** ‚Üê bookings (1:N)
19. **bookings** ‚Üê booking_payments (1:N)
20. **bookings** ‚Üê booking_reviews (1:1)
21. **posts** ‚Üê post_likes (1:N)
22. **posts** ‚Üê post_comments (1:N)
23. **posts** ‚Üê photographer_portfolios (1:N, via post_id)
24. **post_comments** ‚Üê post_comments (1:N, parent comments)
25. **discussion_topics** ‚Üê discussion_replies (1:N)
26. **discussion_replies** ‚Üê discussion_replies (1:N, nested replies)
27. **community_groups** ‚Üê group_members (1:N)
28. **community_groups** ‚Üê messages (1:N, group chats)
29. **collaborations** ‚Üê collaboration_responses (1:N)
30. **users** ‚Üê follows (N:N, follower/following)

---

## üîß DATABASE FUNCTIONS & TRIGGERS

### Utility Functions

1. **update_updated_at_column()**
   - Automatically updates `updated_at` timestamp on row updates
   - Used by all table update triggers

### Business Logic Triggers

1. **update_photographer_rating_after_review()**
   - Updates photographer rating and total_reviews when a review is inserted
   - Trigger: AFTER INSERT ON booking_reviews

2. **increment_post_likes()** / **decrement_post_likes()**
   - Automatically updates post.likes_count
   - Triggers: AFTER INSERT/DELETE ON post_likes

3. **increment_post_comments()** / **decrement_post_comments()**
   - Automatically updates post.comments_count
   - Triggers: AFTER INSERT/DELETE ON post_comments

4. **increment_discussion_replies()** / **decrement_discussion_replies()**
   - Updates discussion_topics.replies_count and last_activity_at
   - Triggers: AFTER INSERT/DELETE ON discussion_replies

5. **increment_group_members()** / **decrement_group_members()**
   - Updates community_groups.member_count and last_activity_at
   - Triggers: AFTER INSERT/DELETE ON group_members

6. **increment_collaboration_responses()** / **decrement_collaboration_responses()**
   - Updates collaborations.responses_count
   - Triggers: AFTER INSERT/DELETE ON collaboration_responses

### Update Timestamp Triggers

All tables have BEFORE UPDATE triggers that call `update_updated_at_column()` to automatically update the `updated_at` field.

---

## üìä DATABASE VIEWS

### 1. view_users_complete
**Purpose:** Complete user information with profile
```sql
SELECT 
    u.user_id,
    u.email,
    u.user_type,
    u.is_verified,
    u.is_active,
    u.last_login,
    u.created_at AS user_created_at,
    up.full_name,
    up.avatar_url,
    up.bio,
    up.phone,
    up.location,
    up.city,
    up.state,
    up.country
FROM users u
LEFT JOIN user_profiles up ON u.user_id = up.user_id;
```

### 2. view_photographers_complete
**Purpose:** Complete photographer profile with user info
```sql
SELECT 
    p.*,
    u.email,
    u.is_verified AS user_verified,
    u.is_active AS user_active,
    up.full_name,
    up.avatar_url,
    up.bio,
    up.phone,
    up.location,
    up.city,
    up.state
FROM photographers p
JOIN users u ON p.user_id = u.user_id
JOIN user_profiles up ON u.user_id = up.user_id;
```

### 3. view_bookings_active
**Purpose:** Active bookings with customer and photographer details
```sql
SELECT 
    b.*,
    up_customer.full_name AS customer_name,
    up_customer.phone AS customer_phone,
    p.business_name AS photographer_business,
    up_photographer.full_name AS photographer_name,
    up_photographer.phone AS photographer_phone,
    e.title AS event_title,
    ec.category_name AS event_category
FROM bookings b
JOIN user_profiles up_customer ON b.customer_id = up_customer.user_id
JOIN photographers p ON b.photographer_id = p.photographer_id
JOIN user_profiles up_photographer ON p.user_id = up_photographer.user_id
LEFT JOIN events e ON b.event_id = e.event_id
LEFT JOIN event_categories ec ON e.category_id = ec.category_id
WHERE b.status IN ('pending', 'confirmed', 'in_progress');
```

---

## üìù ALL SQL QUERIES FROM CODEBASE

### Authentication Queries

#### User Registration
```sql
INSERT INTO users (email, password_hash, user_type)
VALUES ($1, $2, $3)
RETURNING user_id, email, user_type, is_verified, is_active, created_at;
```

#### User Login
```sql
SELECT u.*, up.*
FROM users u
LEFT JOIN user_profiles up ON u.user_id = up.user_id
WHERE u.email = $1 AND u.is_active = true;
```

#### Update Last Login
```sql
UPDATE users 
SET last_login = CURRENT_TIMESTAMP 
WHERE user_id = $1;
```

---

### User Profile Queries

#### Get User Profile
```sql
SELECT u.*, up.*
FROM users u
LEFT JOIN user_profiles up ON u.user_id = up.user_id
WHERE u.user_id = $1;
```

#### Update User Profile
```sql
UPDATE user_profiles 
SET full_name = $1, bio = $2, phone = $3, location = $4, 
    city = $5, state = $6, updated_at = CURRENT_TIMESTAMP
WHERE user_id = $1;
```

---

### Photographer Queries

#### Get All Photographers
```sql
SELECT p.*, up.full_name, up.avatar_url, up.location, up.city, up.state
FROM photographers p
JOIN users u ON p.user_id = u.user_id
JOIN user_profiles up ON u.user_id = up.user_id
WHERE p.is_active = true
ORDER BY p.rating DESC, p.total_reviews DESC;
```

#### Get Photographer by ID
```sql
SELECT p.*, u.email, u.is_verified, up.full_name, up.avatar_url, up.bio, up.phone, up.location
FROM photographers p
JOIN users u ON p.user_id = u.user_id
JOIN user_profiles up ON u.user_id = up.user_id
WHERE p.photographer_id = $1;
```

#### Get Photographer Portfolio
```sql
SELECT * FROM photographer_portfolios
WHERE photographer_id = $1 AND is_active = true
ORDER BY display_order ASC, created_at DESC;
```

#### Update Photographer Rating (Trigger)
```sql
UPDATE photographers
SET rating = COALESCE((
    SELECT AVG(rating)::DECIMAL(3,2)
    FROM booking_reviews
    WHERE photographer_id = NEW.photographer_id
), 0),
total_reviews = (
    SELECT COUNT(*)
    FROM booking_reviews
    WHERE photographer_id = NEW.photographer_id
)
WHERE photographer_id = NEW.photographer_id;
```

---

### Event Queries

#### Get All Events
```sql
SELECT e.*, ec.category_name, ec.slug, up.full_name as creator_name
FROM events e
JOIN event_categories ec ON e.category_id = ec.category_id
JOIN user_profiles up ON e.creator_id = up.user_id
WHERE e.status = 'open' AND e.visibility = 'public'
ORDER BY e.created_at DESC;
```

#### Get Event by ID
```sql
SELECT e.*, ec.category_name, up.full_name as creator_name
FROM events e
JOIN event_categories ec ON e.category_id = ec.category_id
JOIN user_profiles up ON e.creator_id = up.user_id
WHERE e.event_id = $1;
```

---

### Booking Queries

#### Create Booking
```sql
INSERT INTO bookings (
    customer_id, photographer_id, event_id, booking_date, booking_time,
    duration_hours, location, total_amount, status, payment_status
)
VALUES ($1, $2, $3, $4, $5, $6, $7, $8, 'pending', 'unpaid')
RETURNING *;
```

#### Get User Bookings
```sql
SELECT b.*, p.business_name, up.full_name as photographer_name, 
       e.title as event_title
FROM bookings b
JOIN photographers p ON b.photographer_id = p.photographer_id
JOIN user_profiles up ON p.user_id = up.user_id
LEFT JOIN events e ON b.event_id = e.event_id
WHERE b.customer_id = $1
ORDER BY b.created_at DESC;
```

#### Update Booking Status
```sql
UPDATE bookings 
SET status = $1, updated_at = CURRENT_TIMESTAMP
WHERE booking_id = $2;
```

---

### Post Queries

#### Get All Posts (Feed)
```sql
SELECT p.*, up.full_name, up.avatar_url
FROM posts p
JOIN users u ON p.user_id = u.user_id
JOIN user_profiles up ON u.user_id = up.user_id
WHERE p.is_active = true
ORDER BY p.created_at DESC
LIMIT $1 OFFSET $2;
```

#### Create Post
```sql
INSERT INTO posts (user_id, content_type, caption, media_urls, visibility)
VALUES ($1, $2, $3, $4, $5)
RETURNING *;
```

#### Like Post
```sql
INSERT INTO post_likes (post_id, user_id)
VALUES ($1, $2)
ON CONFLICT (post_id, user_id) DO NOTHING;
```

#### Unlike Post
```sql
DELETE FROM post_likes 
WHERE post_id = $1 AND user_id = $2;
```

#### Get Post Comments
```sql
SELECT pc.*, up.full_name, up.avatar_url
FROM post_comments pc
JOIN user_profiles up ON pc.user_id = up.user_id
WHERE pc.post_id = $1 AND pc.is_active = true
ORDER BY pc.created_at ASC;
```

#### Add Comment
```sql
INSERT INTO post_comments (post_id, user_id, comment_text, parent_comment_id)
VALUES ($1, $2, $3, $4)
RETURNING *;
```

---

### Message Queries

#### Get Conversations
```sql
WITH user_conversations AS (
    SELECT DISTINCT
        CASE 
            WHEN sender_id = $1 THEN receiver_id
            ELSE sender_id
        END AS other_user_id,
        MAX(created_at) as last_message_at
    FROM messages
    WHERE (sender_id = $1 OR receiver_id = $1)
      AND (
        (sender_id = $1 AND is_deleted_by_sender = false)
        OR (receiver_id = $1 AND is_deleted_by_receiver = false)
      )
    GROUP BY other_user_id
),
last_messages AS (
    SELECT DISTINCT ON (uc.other_user_id)
        m.message_id,
        m.sender_id,
        m.receiver_id,
        m.message_text,
        m.message_type,
        m.attachment_url,
        m.is_read,
        m.created_at,
        uc.other_user_id
    FROM user_conversations uc
    JOIN messages m ON (
        (m.sender_id = $1 AND m.receiver_id = uc.other_user_id)
        OR (m.sender_id = uc.other_user_id AND m.receiver_id = $1)
    )
    WHERE (
        (m.sender_id = $1 AND m.is_deleted_by_sender = false)
        OR (m.receiver_id = $1 AND m.is_deleted_by_receiver = false)
    )
    ORDER BY uc.other_user_id, m.created_at DESC
),
unread_counts AS (
    SELECT 
        CASE 
            WHEN sender_id = $1 THEN receiver_id
            ELSE sender_id
        END AS other_user_id,
        COUNT(*) as unread_count
    FROM messages
    WHERE receiver_id = $1 
      AND is_read = false
      AND is_deleted_by_receiver = false
    GROUP BY other_user_id
)
SELECT 
    lm.other_user_id as participant_id,
    up.full_name as participant_name,
    up.avatar_url as participant_avatar,
    lm.message_text as last_message,
    lm.message_type,
    lm.is_read,
    lm.created_at as timestamp,
    COALESCE(uc.unread_count, 0) as unread_count
FROM last_messages lm
JOIN user_profiles up ON up.user_id = lm.other_user_id
LEFT JOIN unread_counts uc ON uc.other_user_id = lm.other_user_id
ORDER BY lm.created_at DESC;
```

#### Get Messages for Conversation
```sql
SELECT m.*, up.full_name as sender_name, up.avatar_url as sender_avatar
FROM messages m
JOIN user_profiles up ON m.sender_id = up.user_id
WHERE (
    (m.sender_id = $1 AND m.receiver_id = $2)
    OR (m.sender_id = $2 AND m.receiver_id = $1)
)
AND (
    (m.sender_id = $1 AND m.is_deleted_by_sender = false)
    OR (m.receiver_id = $1 AND m.is_deleted_by_receiver = false)
)
ORDER BY m.created_at ASC;
```

#### Send Message
```sql
INSERT INTO messages (sender_id, receiver_id, message_text, message_type, attachment_url)
VALUES ($1, $2, $3, $4, $5)
RETURNING *;
```

#### Mark Messages as Read
```sql
UPDATE messages 
SET is_read = true, read_at = CURRENT_TIMESTAMP
WHERE receiver_id = $1 AND sender_id = $2 AND is_read = false;
```

---

### Discussion Queries

#### Get Discussion Topics
```sql
SELECT 
    dt.*,
    up.full_name as author_name,
    up.avatar_url as author_avatar,
    u.user_type as author_type
FROM discussion_topics dt
JOIN user_profiles up ON dt.user_id = up.user_id
JOIN users u ON dt.user_id = u.user_id
WHERE dt.is_locked = false
ORDER BY dt.created_at DESC
LIMIT $1 OFFSET $2;
```

#### Get Topic by ID
```sql
SELECT dt.*, up.full_name as author_name, up.avatar_url as author_avatar
FROM discussion_topics dt
JOIN user_profiles up ON dt.user_id = up.user_id
WHERE dt.topic_id = $1;
```

#### Create Topic
```sql
INSERT INTO discussion_topics (user_id, title, description, category)
VALUES ($1, $2, $3, $4)
RETURNING *;
```

#### Get Topic Replies
```sql
SELECT dr.*, up.full_name, up.avatar_url, u.user_type
FROM discussion_replies dr
JOIN user_profiles up ON dr.user_id = up.user_id
JOIN users u ON dr.user_id = u.user_id
WHERE dr.topic_id = $1 AND dr.is_active = true
ORDER BY dr.created_at ASC;
```

#### Add Reply
```sql
INSERT INTO discussion_replies (topic_id, user_id, reply_text, parent_reply_id)
VALUES ($1, $2, $3, $4)
RETURNING *;
```

---

### Group Queries

#### Get All Groups
```sql
SELECT 
    cg.*,
    (SELECT role FROM group_members 
     WHERE group_id = cg.group_id AND user_id = $1) as user_role
FROM community_groups cg
WHERE cg.is_active = true 
  AND (cg.is_public = true OR cg.creator_id = $1 
       OR EXISTS (SELECT 1 FROM group_members 
                  WHERE group_id = cg.group_id AND user_id = $1))
ORDER BY cg.last_activity_at DESC;
```

#### Get Group by ID
```sql
SELECT cg.*, gm.role as user_role
FROM community_groups cg
LEFT JOIN group_members gm ON cg.group_id = gm.group_id AND gm.user_id = $1
WHERE cg.group_id = $2 AND cg.is_active = true;
```

#### Create Group
```sql
INSERT INTO community_groups (creator_id, group_name, group_type, description, group_icon_url, is_public)
VALUES ($1, $2, $3, $4, $5, $6)
RETURNING *;
```

#### Join Group
```sql
INSERT INTO group_members (group_id, user_id, role)
VALUES ($1, $2, 'member')
RETURNING *;
```

#### Leave Group
```sql
DELETE FROM group_members 
WHERE group_id = $1 AND user_id = $2;
```

#### Get Group Members
```sql
SELECT gm.*, up.full_name, up.avatar_url, u.user_type
FROM group_members gm
JOIN user_profiles up ON gm.user_id = up.user_id
JOIN users u ON gm.user_id = u.user_id
WHERE gm.group_id = $1
ORDER BY gm.joined_at ASC;
```

#### Get Group Messages
```sql
SELECT 
    m.*,
    up.full_name as sender_name,
    up.avatar_url as sender_avatar,
    u.user_type as sender_type
FROM messages m
JOIN user_profiles up ON m.sender_id = up.user_id
JOIN users u ON m.sender_id = u.user_id
WHERE m.group_id = $1
ORDER BY m.created_at DESC
LIMIT $2 OFFSET $3;
```

#### Send Group Message
```sql
INSERT INTO messages (sender_id, group_id, message_text, message_type, attachment_url)
VALUES ($1, $2, $3, $4, $5)
RETURNING *;
```

---

### Collaboration Queries

#### Get Collaborations
```sql
SELECT 
    c.*,
    up.full_name as creator_name,
    up.avatar_url as creator_avatar,
    u.user_type as creator_type
FROM collaborations c
JOIN user_profiles up ON c.user_id = up.user_id
JOIN users u ON c.user_id = u.user_id
WHERE c.is_active = true
ORDER BY c.created_at DESC;
```

#### Create Collaboration
```sql
INSERT INTO collaborations (
    user_id, collaboration_type, title, description, 
    skills, location, date, budget, min_budget, max_budget
)
VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
RETURNING *;
```

#### Get Collaboration Responses
```sql
SELECT cr.*, up.full_name, up.avatar_url
FROM collaboration_responses cr
JOIN user_profiles up ON cr.user_id = up.user_id
WHERE cr.collaboration_id = $1
ORDER BY cr.created_at DESC;
```

#### Respond to Collaboration
```sql
INSERT INTO collaboration_responses (collaboration_id, user_id, message)
VALUES ($1, $2, $3)
RETURNING *;
```

---

### Follow Queries

#### Follow User
```sql
INSERT INTO follows (follower_id, following_id)
VALUES ($1, $2)
ON CONFLICT (follower_id, following_id) DO NOTHING;
```

#### Unfollow User
```sql
DELETE FROM follows 
WHERE follower_id = $1 AND following_id = $2;
```

#### Get Followers
```sql
SELECT f.*, up.full_name, up.avatar_url
FROM follows f
JOIN user_profiles up ON f.follower_id = up.user_id
WHERE f.following_id = $1;
```

#### Get Following
```sql
SELECT f.*, up.full_name, up.avatar_url
FROM follows f
JOIN user_profiles up ON f.following_id = up.user_id
WHERE f.follower_id = $1;
```

---

### Notification Queries

#### Get Notifications
```sql
SELECT * FROM notifications
WHERE user_id = $1
ORDER BY created_at DESC
LIMIT $2 OFFSET $3;
```

#### Mark Notification as Read
```sql
UPDATE notifications 
SET is_read = true, read_at = CURRENT_TIMESTAMP
WHERE notification_id = $1 AND user_id = $2;
```

#### Create Notification
```sql
INSERT INTO notifications (user_id, type, title, message, link, data, priority)
VALUES ($1, $2, $3, $4, $5, $6, $7)
RETURNING *;
```

---

## üóÇÔ∏è DATABASE SETUP COMMANDS

### Create Database
```sql
CREATE DATABASE chitrasethu;
```

### Connect to Database
```sql
\c chitrasethu
```

### Run Schema
```bash
psql -U postgres -d chitrasethu -f database/schema_postgres.sql
```

### Run Migrations
```bash
psql -U postgres -d chitrasethu -f database/migrations/add_community_buzz_tables.sql
psql -U postgres -d chitrasethu -f database/migrations/add_cloudinary_metadata.sql
psql -U postgres -d chitrasethu -f database/migrations/add_photographer_professional_fields.sql
psql -U postgres -d chitrasethu -f database/migrations/add_post_id_to_portfolio.sql
```

### Seed Data
```bash
psql -U postgres -d chitrasethu -f database/seed_postgres.sql
psql -U postgres -d chitrasethu -f database/seed_community_buzz.sql
```

---

## üìà TABLE COUNT SUMMARY

**Total Tables:** 25

**Breakdown:**
- User Management: 4 tables
- Photographer Management: 3 tables
- Event & Booking Management: 5 tables
- Social Features: 4 tables
- Communication: 2 tables
- Community Buzz: 7 tables

---

## üìù NOTES

1. **Database Type:** PostgreSQL (migrated from MySQL)
2. **Parameterized Queries:** All queries use PostgreSQL parameterized queries ($1, $2, etc.)
3. **JSONB Columns:** Used for flexible data storage (tags, arrays, metadata)
4. **Soft Deletes:** Some tables use `is_active` flags instead of hard deletes
5. **Timestamps:** All tables have `created_at` and `updated_at` with automatic triggers
6. **Cascading Deletes:** Foreign keys use CASCADE for automatic cleanup
7. **Indexes:** Comprehensive indexing for performance optimization
8. **Full-Text Search:** GIN indexes on text fields for search functionality

---

**Last Updated:** 2025-01-XX  
**Schema Version:** 1.0.0  
**Documentation Version:** 1.0.0













